<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# auth

```go
import "github.com/snapp-incubator/Cerberus/pkg/auth"
```

## Index

- [func NewServerCredentials\(certPath string, keyPath string, caPath string\) \(credentials.TransportCredentials, error\)](<#NewServerCredentials>)
- [func RegisterServer\(srv \*grpc.Server, c Checker\)](<#RegisterServer>)
- [func RunServer\(ctx context.Context, listener net.Listener, srv \*grpc.Server\) error](<#RunServer>)
- [type AccessCache](<#AccessCache>)
- [type AccessCacheEntry](<#AccessCacheEntry>)
- [type Authenticator](<#Authenticator>)
  - [func NewAuthenticator\(logger logr.Logger\) \(\*Authenticator, error\)](<#NewAuthenticator>)
  - [func \(a \*Authenticator\) Check\(ctx context.Context, request \*Request\) \(\*Response, error\)](<#Authenticator.Check>)
  - [func \(a \*Authenticator\) TestAccess\(wsvc string, token string\) \(bool, CerberusReason\)](<#Authenticator.TestAccess>)
  - [func \(a \*Authenticator\) UpdateCache\(c client.Client, ctx context.Context\) error](<#Authenticator.UpdateCache>)
- [type CerberusReason](<#CerberusReason>)
- [type CheckRequestV2](<#CheckRequestV2>)
- [type CheckRequestV3](<#CheckRequestV3>)
- [type CheckResponseV2](<#CheckResponseV2>)
- [type CheckResponseV3](<#CheckResponseV3>)
- [type Checker](<#Checker>)
- [type Request](<#Request>)
  - [func \(r \*Request\) FromV2\(c \*CheckRequestV2\) \*Request](<#Request.FromV2>)
  - [func \(r \*Request\) FromV3\(c \*CheckRequestV3\) \*Request](<#Request.FromV3>)
- [type Response](<#Response>)
  - [func \(r \*Response\) AsV2\(\) \*CheckResponseV2](<#Response.AsV2>)
  - [func \(r \*Response\) AsV3\(\) \*CheckResponseV3](<#Response.AsV3>)
- [type ServicesCache](<#ServicesCache>)
- [type Testserver](<#Testserver>)
  - [func \(t \*Testserver\) Check\(xts context.Context, request \*Request\) \(\*Response, error\)](<#Testserver.Check>)


<a name="NewServerCredentials"></a>
## func [NewServerCredentials](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/server.go#L89>)

```go
func NewServerCredentials(certPath string, keyPath string, caPath string) (credentials.TransportCredentials, error)
```

NewServerCredentials loads TLS transport credentials for the GRPC server.

<a name="RegisterServer"></a>
## func [RegisterServer](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/server.go#L63>)

```go
func RegisterServer(srv *grpc.Server, c Checker)
```

RegisterServer registers the Checker with the external authorization GRPC server.

<a name="RunServer"></a>
## func [RunServer](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/server.go#L72>)

```go
func RunServer(ctx context.Context, listener net.Listener, srv *grpc.Server) error
```

RunServer runs the server until signaled by stopChan.

<a name="AccessCache"></a>
## type [AccessCache](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L25>)



```go
type AccessCache map[string]AccessCacheEntry
```

<a name="AccessCacheEntry"></a>
## type [AccessCacheEntry](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L28-L32>)



```go
type AccessCacheEntry struct {
    cerberusv1alpha1.AccessToken
    // contains filtered or unexported fields
}
```

<a name="Authenticator"></a>
## type [Authenticator](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L15-L23>)



```go
type Authenticator struct {
    // contains filtered or unexported fields
}
```

<a name="NewAuthenticator"></a>
### func [NewAuthenticator](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L193>)

```go
func NewAuthenticator(logger logr.Logger) (*Authenticator, error)
```



<a name="Authenticator.Check"></a>
### func \(\*Authenticator\) [Check](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L167>)

```go
func (a *Authenticator) Check(ctx context.Context, request *Request) (*Response, error)
```



<a name="Authenticator.TestAccess"></a>
### func \(\*Authenticator\) [TestAccess](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L143>)

```go
func (a *Authenticator) TestAccess(wsvc string, token string) (bool, CerberusReason)
```



<a name="Authenticator.UpdateCache"></a>
### func \(\*Authenticator\) [UpdateCache](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L54>)

```go
func (a *Authenticator) UpdateCache(c client.Client, ctx context.Context) error
```

TODO add Secrets to be watched

<a name="CerberusReason"></a>
## type [CerberusReason](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L34>)



```go
type CerberusReason string
```

<a name="CerberusReasonOK"></a>

```go
const (
    CerberusReasonOK                 CerberusReason = "ok"
    CerberusReasonUnauthorized       CerberusReason = "unauthorized"
    CerberusReasonTokenEmpty         CerberusReason = "token-empty"
    CerberusReasonLookupEmpty        CerberusReason = "lookup-empty"
    CerberusReasonTokenNotFound      CerberusReason = "token-notfound"
    CerberusReasonWebserviceNotFound CerberusReason = "webservice-notfound"
)
```

<a name="CheckRequestV2"></a>
## type [CheckRequestV2](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/server.go#L16>)



```go
type CheckRequestV2 = envoy_service_auth_v2.CheckRequest //nolint:golint
```

<a name="CheckRequestV3"></a>
## type [CheckRequestV3](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/server.go#L18>)



```go
type CheckRequestV3 = envoy_service_auth_v3.CheckRequest //nolint:golint
```

<a name="CheckResponseV2"></a>
## type [CheckResponseV2](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/server.go#L17>)



```go
type CheckResponseV2 = envoy_service_auth_v2.CheckResponse //nolint:golint
```

<a name="CheckResponseV3"></a>
## type [CheckResponseV3](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/server.go#L19>)



```go
type CheckResponseV3 = envoy_service_auth_v3.CheckResponse //nolint:golint
```

<a name="Checker"></a>
## type [Checker](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/server.go#L25-L27>)

Checker is an implementation of the Envoy External Auth API.

https://github.com/envoyproxy/envoy/blob/release/v1.14/api/envoy/service/auth/v3/external_auth.proto https://github.com/envoyproxy/envoy/blob/release/v1.14/api/envoy/service/auth/v2/external_auth.proto

```go
type Checker interface {
    Check(context.Context, *Request) (*Response, error)
}
```

<a name="Request"></a>
## type [Request](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/convert.go#L18-L22>)

Request captures the information needed to process a CheckRequest.

```go
type Request struct {
    Context map[string]string
    Request http.Request
    ID      string
}
```

<a name="Request.FromV2"></a>
### func \(\*Request\) [FromV2](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/convert.go#L25>)

```go
func (r *Request) FromV2(c *CheckRequestV2) *Request
```

FromV2 initializes a Request from a v2 CheckRequest.

<a name="Request.FromV3"></a>
### func \(\*Request\) [FromV3](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/convert.go#L50>)

```go
func (r *Request) FromV3(c *CheckRequestV3) *Request
```

FromV3 initializes a Request from a v3 CheckRequest.

<a name="Response"></a>
## type [Response](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/convert.go#L75-L78>)

Response captures the information needed to generate a CheckResponse.

```go
type Response struct {
    Allow    bool
    Response http.Response
}
```

<a name="Response.AsV2"></a>
### func \(\*Response\) [AsV2](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/convert.go#L81>)

```go
func (r *Response) AsV2() *CheckResponseV2
```

AsV2 converts to a v2 CheckResponse.

<a name="Response.AsV3"></a>
### func \(\*Response\) [AsV3](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/convert.go#L121>)

```go
func (r *Response) AsV3() *CheckResponseV3
```

AsV3 converts to a v3 CheckResponse.

<a name="ServicesCache"></a>
## type [ServicesCache](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/authenticator.go#L26>)



```go
type ServicesCache map[string]struct{}
```

<a name="Testserver"></a>
## type [Testserver](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/testserver.go#L13-L15>)

Testserver is a no\-op implementation of the Checker interface. For testing only.

```go
type Testserver struct {
    Log logr.Logger
}
```

<a name="Testserver.Check"></a>
### func \(\*Testserver\) [Check](<https://github.com/snapp-incubator/Cerberus/blob/main/pkg/auth/testserver.go#L20>)

```go
func (t *Testserver) Check(xts context.Context, request *Request) (*Response, error)
```

Check ...

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
